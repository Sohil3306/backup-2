<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI-Enhanced Survey Data Analysis | MoSPI Hackathon</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React and ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Additional Libraries -->
    <script src="https://unpkg.com/papaparse@5.4.1/papaparse.min.js"></script>
    <script src="https://unpkg.com/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="https://unpkg.com/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <script src="https://unpkg.com/jspdf-autotable@3.5.29/dist/jspdf.plugin.autotable.min.js"></script>
    <script src="https://unpkg.com/mathjs@11.8.0/lib/browser/math.js"></script>
    <script src="https://unpkg.com/lodash@4.17.21/lodash.min.js"></script>
    
    <!-- Framer Motion -->
    <script src="https://unpkg.com/framer-motion@10.12.16/dist/framer-motion.js"></script>
    
    <!-- React Hot Toast -->
    <script src="https://unpkg.com/react-hot-toast@2.4.1/dist/react-hot-toast.min.js"></script>
    
    <!-- Lucide React Icons -->
    <script src="https://unpkg.com/lucide@0.263.1/dist/umd/lucide.min.js"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        @tailwind base;
        @tailwind components;
        @tailwind utilities;
        
        @layer base {
            html { scroll-behavior: smooth; }
            body { 
                @apply bg-gradient-to-br from-slate-50 to-blue-50 min-h-screen font-sans antialiased;
                font-family: 'Inter', system-ui, sans-serif;
            }
        }
        
        @layer components {
            .btn-primary {
                @apply bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white font-semibold py-3 px-6 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 transform hover:-translate-y-0.5 focus:outline-none focus:ring-4 focus:ring-blue-500/20;
            }
            
            .btn-secondary {
                @apply bg-white hover:bg-gray-50 text-gray-700 font-semibold py-3 px-6 rounded-xl border border-gray-200 shadow-lg hover:shadow-xl transition-all duration-300 transform hover:-translate-y-0.5 focus:outline-none focus:ring-4 focus:ring-gray-500/20;
            }
            
            .btn-success {
                @apply bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white font-semibold py-3 px-6 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 transform hover:-translate-y-0.5 focus:outline-none focus:ring-4 focus:ring-green-500/20;
            }
            
            .card {
                @apply bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden transition-all duration-300 hover:shadow-xl;
            }
            
            .input-field {
                @apply w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-4 focus:ring-blue-500/20 focus:border-blue-500 transition-all duration-300 bg-white shadow-sm;
            }
            
            .badge {
                @apply inline-flex items-center px-3 py-1 rounded-full text-xs font-medium;
            }
            
            .badge-primary {
                @apply bg-blue-100 text-blue-800;
            }
            
            .badge-success {
                @apply bg-green-100 text-green-800;
            }
            
            .badge-warning {
                @apply bg-yellow-100 text-yellow-800;
            }
            
            .badge-danger {
                @apply bg-red-100 text-red-800;
            }
            
            .gradient-text {
                @apply bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent;
            }
            
            .shadow-glow {
                box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
            }
            
            .shadow-glow-success {
                box-shadow: 0 0 20px rgba(34, 197, 94, 0.3);
            }
            
            .animate-float {
                animation: float 6s ease-in-out infinite;
            }
            
            @keyframes float {
                0%, 100% { transform: translateY(0px); }
                50% { transform: translateY(-10px); }
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // Utility Classes
        class DataProcessor {
            constructor() {
                this.data = null;
                this.cleanedData = null;
            }

            loadData(data) {
                this.data = data;
                this.cleanedData = [...data];
                
                const numericColumns = this.getNumericColumns();
                const sampleData = data.slice(0, 5);
                
                return {
                    shape: [data.length, Object.keys(data[0]).length],
                    columns: Object.keys(data[0]),
                    numericColumns,
                    sampleData,
                    dtypes: this.getDataTypes()
                };
            }

            getNumericColumns() {
                if (!this.data || this.data.length === 0) return [];
                
                const firstRow = this.data[0];
                return Object.keys(firstRow).filter(col => {
                    const value = firstRow[col];
                    return !isNaN(parseFloat(value)) && isFinite(value);
                });
            }

            getDataTypes() {
                if (!this.data || this.data.length === 0) return {};
                
                const firstRow = this.data[0];
                const dtypes = {};
                
                Object.keys(firstRow).forEach(col => {
                    const value = firstRow[col];
                    if (!isNaN(parseFloat(value)) && isFinite(value)) {
                        dtypes[col] = 'number';
                    } else {
                        dtypes[col] = 'string';
                    }
                });
                
                return dtypes;
            }

            detectMissingValues() {
                if (!this.data) return null;
                
                const missingInfo = {};
                const columns = Object.keys(this.data[0]);
                let totalMissing = 0;
                
                columns.forEach(col => {
                    const missingCount = this.data.filter(row => 
                        row[col] === null || row[col] === undefined || row[col] === ''
                    ).length;
                    
                    if (missingCount > 0) {
                        missingInfo[col] = missingCount;
                        totalMissing += missingCount;
                    }
                });
                
                return {
                    totalMissing,
                    percentage: (totalMissing / (this.data.length * columns.length)) * 100,
                    byColumn: missingInfo
                };
            }

            imputeMissingValues(method, columns = null) {
                if (!this.cleanedData) return;
                
                const colsToImpute = columns || this.getNumericColumns();
                
                colsToImpute.forEach(col => {
                    const values = this.cleanedData
                        .map(row => parseFloat(row[col]))
                        .filter(val => !isNaN(val));
                    
                    if (values.length === 0) return;
                    
                    let imputeValue;
                    switch (method) {
                        case 'mean':
                            imputeValue = values.reduce((a, b) => a + b, 0) / values.length;
                            break;
                        case 'median':
                            const sorted = values.sort((a, b) => a - b);
                            imputeValue = sorted[Math.floor(sorted.length / 2)];
                            break;
                        case 'knn':
                            imputeValue = values.reduce((a, b) => a + b, 0) / values.length;
                            break;
                        default:
                            return;
                    }
                    
                    this.cleanedData.forEach(row => {
                        if (row[col] === null || row[col] === undefined || row[col] === '') {
                            row[col] = imputeValue;
                        }
                    });
                });
            }

            detectOutliers(method) {
                if (!this.cleanedData) return null;
                
                const outliersInfo = {};
                const numericCols = this.getNumericColumns();
                
                numericCols.forEach(col => {
                    const values = this.cleanedData
                        .map(row => parseFloat(row[col]))
                        .filter(val => !isNaN(val));
                    
                    if (values.length === 0) return;
                    
                    let outliers = [];
                    if (method === 'iqr') {
                        const sorted = values.sort((a, b) => a - b);
                        const q1 = sorted[Math.floor(sorted.length * 0.25)];
                        const q3 = sorted[Math.floor(sorted.length * 0.75)];
                        const iqr = q3 - q1;
                        const lowerBound = q1 - 1.5 * iqr;
                        const upperBound = q3 + 1.5 * iqr;
                        
                        outliers = values.filter(val => val < lowerBound || val > upperBound);
                    } else if (method === 'zscore') {
                        const mean = values.reduce((a, b) => a + b, 0) / values.length;
                        const std = Math.sqrt(values.reduce((sq, n) => sq + Math.pow(n - mean, 2), 0) / values.length);
                        
                        outliers = values.filter(val => Math.abs((val - mean) / std) > 3);
                    }
                    
                    if (outliers.length > 0) {
                        outliersInfo[col] = {
                            count: outliers.length,
                            percentage: (outliers.length / values.length) * 100
                        };
                    }
                });
                
                return outliersInfo;
            }

            handleOutliers(strategy, columns = null) {
                if (!this.cleanedData) return;
                
                const colsToCheck = columns || this.getNumericColumns();
                
                colsToCheck.forEach(col => {
                    const values = this.cleanedData
                        .map(row => parseFloat(row[col]))
                        .filter(val => !isNaN(val));
                    
                    if (values.length === 0) return;
                    
                    const sorted = values.sort((a, b) => a - b);
                    const q1 = sorted[Math.floor(sorted.length * 0.25)];
                    const q3 = sorted[Math.floor(sorted.length * 0.75)];
                    const iqr = q3 - q1;
                    const lowerBound = q1 - 1.5 * iqr;
                    const upperBound = q3 + 1.5 * iqr;
                    
                    if (strategy === 'winsorize') {
                        this.cleanedData.forEach(row => {
                            const val = parseFloat(row[col]);
                            if (!isNaN(val)) {
                                if (val < lowerBound) row[col] = lowerBound;
                                if (val > upperBound) row[col] = upperBound;
                            }
                        });
                    } else if (strategy === 'remove') {
                        this.cleanedData = this.cleanedData.filter(row => {
                            const val = parseFloat(row[col]);
                            return isNaN(val) || (val >= lowerBound && val <= upperBound);
                        });
                    }
                });
            }

            applyWeights(weightColumn) {
                if (!this.cleanedData || !weightColumn) return;
                
                this.cleanedData.forEach(row => {
                    if (row[weightColumn]) {
                        row._weight = parseFloat(row[weightColumn]);
                    } else {
                        row._weight = 1.0;
                    }
                });
            }

            calculateEstimates(columns = null) {
                if (!this.cleanedData) return {};
                
                const colsToEstimate = columns || this.getNumericColumns();
                const estimates = {};
                
                colsToEstimate.forEach(col => {
                    const values = this.cleanedData
                        .map(row => parseFloat(row[col]))
                        .filter(val => !isNaN(val));
                    
                    if (values.length === 0) return;
                    
                    const weights = this.cleanedData
                        .map(row => row._weight || 1.0)
                        .filter((_, i) => !isNaN(values[i]));
                    
                    // Unweighted statistics
                    const unweightedMean = values.reduce((a, b) => a + b, 0) / values.length;
                    const unweightedVar = values.reduce((sq, n) => sq + Math.pow(n - unweightedMean, 2), 0) / values.length;
                    const unweightedSe = Math.sqrt(unweightedVar / values.length);
                    
                    // Weighted statistics
                    const totalWeight = weights.reduce((a, b) => a + b, 0);
                    const weightedMean = values.reduce((sum, val, i) => sum + val * weights[i], 0) / totalWeight;
                    const weightedVar = values.reduce((sum, val, i) => sum + Math.pow(val - weightedMean, 2) * weights[i], 0) / totalWeight;
                    const weightedSe = Math.sqrt(weightedVar / totalWeight);
                    const moe = weightedSe * 1.96; // 95% confidence interval
                    
                    estimates[col] = {
                        unweighted: {
                            mean: unweightedMean,
                            se: unweightedSe
                        },
                        weighted: {
                            mean: weightedMean,
                            se: weightedSe,
                            moe: moe
                        }
                    };
                });
                
                return estimates;
            }

            getSummaryStatistics() {
                if (!this.cleanedData) return {};
                
                const numericCols = this.getNumericColumns();
                const summary = {};
                
                numericCols.forEach(col => {
                    const values = this.cleanedData
                        .map(row => parseFloat(row[col]))
                        .filter(val => !isNaN(val));
                    
                    if (values.length === 0) return;
                    
                    const sorted = values.sort((a, b) => a - b);
                    summary[col] = {
                        count: values.length,
                        mean: values.reduce((a, b) => a + b, 0) / values.length,
                        median: sorted[Math.floor(sorted.length / 2)],
                        min: sorted[0],
                        max: sorted[sorted.length - 1],
                        std: Math.sqrt(values.reduce((sq, n) => sq + Math.pow(n - (values.reduce((a, b) => a + b, 0) / values.length), 2), 0) / values.length)
                    };
                });
                
                return summary;
            }

            getCorrelationMatrix() {
                if (!this.cleanedData) return {};
                
                const numericCols = this.getNumericColumns();
                const correlationMatrix = {};
                
                numericCols.forEach(col1 => {
                    correlationMatrix[col1] = {};
                    numericCols.forEach(col2 => {
                        if (col1 === col2) {
                            correlationMatrix[col1][col2] = 1;
                        } else {
                            const values1 = this.cleanedData.map(row => parseFloat(row[col1])).filter(val => !isNaN(val));
                            const values2 = this.cleanedData.map(row => parseFloat(row[col2])).filter(val => !isNaN(val));
                            
                            if (values1.length === values2.length && values1.length > 0) {
                                const mean1 = values1.reduce((a, b) => a + b, 0) / values1.length;
                                const mean2 = values2.reduce((a, b) => a + b, 0) / values2.length;
                                
                                const numerator = values1.reduce((sum, val, i) => sum + (val - mean1) * (values2[i] - mean2), 0);
                                const denom1 = Math.sqrt(values1.reduce((sum, val) => sum + Math.pow(val - mean1, 2), 0));
                                const denom2 = Math.sqrt(values2.reduce((sum, val) => sum + Math.pow(val - mean2, 2), 0));
                                
                                correlationMatrix[col1][col2] = denom1 * denom2 !== 0 ? numerator / (denom1 * denom2) : 0;
                            } else {
                                correlationMatrix[col1][col2] = 0;
                            }
                        }
                    });
                });
                
                return correlationMatrix;
            }
        }

        class FileUploader {
            isSupportedFile(file) {
                const supportedTypes = [
                    'text/csv',
                    'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
                    'application/vnd.ms-excel'
                ];
                return supportedTypes.includes(file.type) || 
                       file.name.endsWith('.csv') || 
                       file.name.endsWith('.xlsx') || 
                       file.name.endsWith('.xls');
            }

            getFileType(file) {
                if (file.name.endsWith('.csv')) return 'csv';
                if (file.name.endsWith('.xlsx') || file.name.endsWith('.xls')) return 'excel';
                return 'unknown';
            }

            parseCSV(file) {
                return new Promise((resolve, reject) => {
                    Papa.parse(file, {
                        header: true,
                        skipEmptyLines: true,
                        complete: (results) => {
                            if (results.errors.length > 0) {
                                reject(new Error('CSV parsing error: ' + results.errors[0].message));
                            } else {
                                resolve(results.data);
                            }
                        },
                        error: (error) => {
                            reject(new Error('CSV parsing error: ' + error.message));
                        }
                    });
                });
            }

            parseExcel(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const data = new Uint8Array(e.target.result);
                            const workbook = XLSX.read(data, { type: 'array' });
                            const sheetName = workbook.SheetNames[0];
                            const worksheet = workbook.Sheets[sheetName];
                            const jsonData = XLSX.utils.sheet_to_json(worksheet);
                            resolve(jsonData);
                        } catch (error) {
                            reject(new Error('Excel parsing error: ' + error.message));
                        }
                    };
                    reader.onerror = () => reject(new Error('File reading error'));
                    reader.readAsArrayBuffer(file);
                });
            }

            async uploadFile(file) {
                if (!this.isSupportedFile(file)) {
                    return { success: false, error: 'Unsupported file type' };
                }

                try {
                    const fileType = this.getFileType(file);
                    let data;
                    
                    if (fileType === 'csv') {
                        data = await this.parseCSV(file);
                    } else if (fileType === 'excel') {
                        data = await this.parseExcel(file);
                    } else {
                        return { success: false, error: 'Unknown file type' };
                    }

                    const cleanedData = this.cleanData(data);
                    const validation = this.validateData(cleanedData);
                    
                    if (!validation.valid) {
                        return { success: false, error: validation.error };
                    }

                    return { success: true, data: cleanedData };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            }

            cleanData(data) {
                return data.filter(row => {
                    return Object.keys(row).length > 0 && 
                           Object.values(row).some(val => val !== null && val !== undefined && val !== '');
                });
            }

            validateData(data) {
                if (!data || data.length === 0) {
                    return { valid: false, error: 'No data found in file' };
                }

                if (data.length < 10) {
                    return { valid: false, error: 'File must contain at least 10 records' };
                }

                const columns = Object.keys(data[0]);
                if (columns.length < 2) {
                    return { valid: false, error: 'File must contain at least 2 columns' };
                }

                return { valid: true };
            }

            getSampleData(data, count = 5) {
                return data.slice(0, count);
            }
        }

        class ReportGenerator {
            generateReport(dataInfo, missingInfo, outliersInfo, estimates, summaryStats, correlationMatrix, config) {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Title
                doc.setFontSize(20);
                doc.setFont('helvetica', 'bold');
                doc.text('AI-Enhanced Survey Data Analysis Report', 20, 30);
                
                doc.setFontSize(12);
                doc.setFont('helvetica', 'normal');
                doc.text(`Generated on: ${new Date().toLocaleDateString()}`, 20, 40);
                doc.text(`MoSPI Hackathon Solution`, 20, 50);
                
                let yPosition = 70;
                
                // Data Summary
                yPosition = this.addSectionHeader(doc, 'Data Summary', yPosition);
                yPosition = this.addDataSummary(doc, dataInfo, yPosition);
                
                // Missing Values
                if (missingInfo && missingInfo.totalMissing > 0) {
                    yPosition = this.addSectionHeader(doc, 'Missing Values Analysis', yPosition);
                    yPosition = this.addMissingValuesTable(doc, missingInfo, yPosition);
                }
                
                // Outliers
                if (outliersInfo && Object.keys(outliersInfo).length > 0) {
                    yPosition = this.addSectionHeader(doc, 'Outlier Detection', yPosition);
                    yPosition = this.addOutliersTable(doc, outliersInfo, yPosition);
                }
                
                // Estimates
                if (estimates && Object.keys(estimates).length > 0) {
                    yPosition = this.addSectionHeader(doc, 'Statistical Estimates', yPosition);
                    yPosition = this.addEstimatesTable(doc, estimates, yPosition);
                }
                
                // Summary Statistics
                if (summaryStats && Object.keys(summaryStats).length > 0) {
                    yPosition = this.addSectionHeader(doc, 'Summary Statistics', yPosition);
                    yPosition = this.addSummaryStatisticsTable(doc, summaryStats, yPosition);
                }
                
                // Methodology
                yPosition = this.addSectionHeader(doc, 'Methodology', yPosition);
                yPosition = this.addMethodology(doc, config, yPosition);
                
                // Save the PDF
                const filename = `survey_analysis_report_${new Date().toISOString().split('T')[0]}.pdf`;
                doc.save(filename);
                
                return filename;
            }

            addSectionHeader(doc, title, yPosition) {
                if (yPosition > 250) {
                    doc.addPage();
                    yPosition = 20;
                }
                
                doc.setFontSize(14);
                doc.setFont('helvetica', 'bold');
                doc.text(title, 20, yPosition);
                return yPosition + 10;
            }

            addDataSummary(doc, dataInfo, yPosition) {
                if (yPosition > 250) {
                    doc.addPage();
                    yPosition = 20;
                }
                
                doc.setFontSize(10);
                doc.setFont('helvetica', 'normal');
                doc.text(`Dataset Shape: ${dataInfo.shape[0]} rows × ${dataInfo.shape[1]} columns`, 20, yPosition);
                doc.text(`Total Variables: ${dataInfo.columns.length}`, 20, yPosition + 7);
                doc.text(`Numeric Variables: ${dataInfo.numericColumns.length}`, 20, yPosition + 14);
                
                return yPosition + 25;
            }

            addMissingValuesTable(doc, missingInfo, yPosition) {
                if (yPosition > 250) {
                    doc.addPage();
                    yPosition = 20;
                }
                
                const tableData = [
                    ['Column', 'Missing Count', 'Percentage']
                ];
                
                Object.entries(missingInfo.byColumn).forEach(([col, count]) => {
                    const percentage = ((count / missingInfo.totalMissing) * 100).toFixed(2);
                    tableData.push([col, count.toString(), `${percentage}%`]);
                });
                
                doc.autoTable({
                    startY: yPosition,
                    head: [tableData[0]],
                    body: tableData.slice(1),
                    theme: 'grid',
                    headStyles: { fillColor: [59, 130, 246] }
                });
                
                return doc.lastAutoTable.finalY + 10;
            }

            addOutliersTable(doc, outliersInfo, yPosition) {
                if (yPosition > 250) {
                    doc.addPage();
                    yPosition = 20;
                }
                
                const tableData = [
                    ['Column', 'Outlier Count', 'Percentage']
                ];
                
                Object.entries(outliersInfo).forEach(([col, info]) => {
                    tableData.push([col, info.count.toString(), `${info.percentage.toFixed(2)}%`]);
                });
                
                doc.autoTable({
                    startY: yPosition,
                    head: [tableData[0]],
                    body: tableData.slice(1),
                    theme: 'grid',
                    headStyles: { fillColor: [245, 158, 11] }
                });
                
                return doc.lastAutoTable.finalY + 10;
            }

            addEstimatesTable(doc, estimates, yPosition) {
                if (yPosition > 250) {
                    doc.addPage();
                    yPosition = 20;
                }
                
                const tableData = [
                    ['Variable', 'Weighted Mean', 'Margin of Error', 'Standard Error']
                ];
                
                Object.entries(estimates).forEach(([variable, est]) => {
                    tableData.push([
                        variable,
                        est.weighted.mean.toFixed(4),
                        `±${est.weighted.moe.toFixed(4)}`,
                        est.weighted.se.toFixed(4)
                    ]);
                });
                
                doc.autoTable({
                    startY: yPosition,
                    head: [tableData[0]],
                    body: tableData.slice(1),
                    theme: 'grid',
                    headStyles: { fillColor: [34, 197, 94] }
                });
                
                return doc.lastAutoTable.finalY + 10;
            }

            addSummaryStatisticsTable(doc, summaryStats, yPosition) {
                if (yPosition > 250) {
                    doc.addPage();
                    yPosition = 20;
                }
                
                const tableData = [
                    ['Variable', 'Count', 'Mean', 'Median', 'Std Dev']
                ];
                
                Object.entries(summaryStats).forEach(([variable, stats]) => {
                    tableData.push([
                        variable,
                        stats.count.toString(),
                        stats.mean.toFixed(4),
                        stats.median.toFixed(4),
                        stats.std.toFixed(4)
                    ]);
                });
                
                doc.autoTable({
                    startY: yPosition,
                    head: [tableData[0]],
                    body: tableData.slice(1),
                    theme: 'grid',
                    headStyles: { fillColor: [99, 102, 241] }
                });
                
                return doc.lastAutoTable.finalY + 10;
            }

            addMethodology(doc, config, yPosition) {
                if (yPosition > 250) {
                    doc.addPage();
                    yPosition = 20;
                }
                
                doc.setFontSize(10);
                doc.setFont('helvetica', 'normal');
                
                let text = 'This analysis was performed using AI-enhanced methods:';
                doc.text(text, 20, yPosition);
                yPosition += 10;
                
                if (config.imputationMethod) {
                    text = `• Missing value imputation: ${config.imputationMethod}`;
                    doc.text(text, 25, yPosition);
                    yPosition += 7;
                }
                
                if (config.outlierMethod) {
                    text = `• Outlier detection: ${config.outlierMethod}`;
                    doc.text(text, 25, yPosition);
                    yPosition += 7;
                }
                
                if (config.weightColumn) {
                    text = `• Survey weights applied: ${config.weightColumn}`;
                    doc.text(text, 25, yPosition);
                    yPosition += 7;
                }
                
                text = '• Statistical estimates include weighted means and margins of error';
                doc.text(text, 25, yPosition);
                yPosition += 7;
                
                text = '• All analyses follow official statistical agency standards';
                doc.text(text, 25, yPosition);
                
                return yPosition + 15;
            }
        }

        // Main App Component
        function App() {
            const [currentStep, setCurrentStep] = React.useState(1);
            const [fileData, setFileData] = React.useState(null);
            const [dataInfo, setDataInfo] = React.useState(null);
            const [analysisResults, setAnalysisResults] = React.useState(null);
            const [loading, setLoading] = React.useState(false);
            const [sidebarOpen, setSidebarOpen] = React.useState(false);
            const [currentView, setCurrentView] = React.useState('workflow');
            
            const [config, setConfig] = React.useState({
                imputationMethod: '',
                imputationColumns: [],
                outlierMethod: '',
                outlierHandling: 'winsorize',
                outlierColumns: [],
                weightColumn: '',
                estimateColumns: [],
                validationRules: [],
                skipPatterns: []
            });

            const [analytics, setAnalytics] = React.useState({
                totalFilesProcessed: 0,
                totalRecordsAnalyzed: 0,
                averageProcessingTime: 0,
                successRate: 100,
                lastAnalysisDate: null
            });

            const dataProcessor = new DataProcessor();
            const fileUploader = new FileUploader();
            const reportGenerator = new ReportGenerator();

            // Initialize analytics
            React.useEffect(() => {
                const savedAnalytics = localStorage.getItem('surveyAnalytics');
                if (savedAnalytics) {
                    setAnalytics(JSON.parse(savedAnalytics));
                }
            }, []);

            // Save analytics
            React.useEffect(() => {
                localStorage.setItem('surveyAnalytics', JSON.stringify(analytics));
            }, [analytics]);

            // Handle file upload
            const handleFileUpload = async (file) => {
                setLoading(true);
                
                try {
                    const result = await fileUploader.uploadFile(file);
                    
                    if (result.success) {
                        const validation = fileUploader.validateData(result.data);
                        
                        if (validation.valid) {
                            setFileData(result.data);
                            const info = dataProcessor.loadData(result.data);
                            setDataInfo(info);
                            setCurrentStep(2);
                            
                            // Update analytics
                            setAnalytics(prev => ({
                                ...prev,
                                totalFilesProcessed: prev.totalFilesProcessed + 1,
                                lastAnalysisDate: new Date().toISOString()
                            }));

                            toast.success('Data uploaded successfully!');
                        } else {
                            toast.error(validation.error);
                        }
                    } else {
                        toast.error('File upload failed');
                    }
                } catch (error) {
                    toast.error(`Upload error: ${error.message}`);
                } finally {
                    setLoading(false);
                }
            };

            // Run analysis
            const runAnalysis = async () => {
                if (!fileData) {
                    toast.error('Please upload a file first!');
                    return;
                }

                setLoading(true);
                
                try {
                    const startTime = Date.now();

                    // Apply data cleaning
                    if (config.imputationMethod) {
                        dataProcessor.imputeMissingValues(
                            config.imputationMethod,
                            config.imputationColumns.length > 0 ? config.imputationColumns : null
                        );
                    }

                    if (config.outlierMethod) {
                        dataProcessor.handleOutliers(
                            config.outlierHandling,
                            config.outlierColumns.length > 0 ? config.outlierColumns : null
                        );
                    }

                    // Apply weights
                    dataProcessor.applyWeights(config.weightColumn);

                    // Calculate estimates
                    const estimates = dataProcessor.calculateEstimates(
                        config.estimateColumns.length > 0 ? config.estimateColumns : null
                    );

                    // Get additional statistics
                    const missingInfo = dataProcessor.detectMissingValues();
                    const outliersInfo = dataProcessor.detectOutliers(config.outlierMethod);
                    const summaryStats = dataProcessor.getSummaryStatistics();
                    const correlationMatrix = dataProcessor.getCorrelationMatrix();

                    const processingTime = Date.now() - startTime;

                    const results = {
                        estimates,
                        missingInfo,
                        outliersInfo,
                        summaryStats,
                        correlationMatrix,
                        cleanedShape: dataProcessor.cleanedData ? [dataProcessor.cleanedData.length, Object.keys(dataProcessor.cleanedData[0]).length] : null,
                        processingTime,
                        timestamp: new Date().toISOString()
                    };

                    setAnalysisResults(results);
                    setCurrentStep(4);
                    setCurrentView('results');

                    // Update analytics
                    setAnalytics(prev => ({
                        ...prev,
                        totalRecordsAnalyzed: prev.totalRecordsAnalyzed + (dataProcessor.cleanedData?.length || 0),
                        averageProcessingTime: (prev.averageProcessingTime + processingTime) / 2,
                        lastAnalysisDate: new Date().toISOString()
                    }));

                    toast.success('Analysis completed successfully!');
                } catch (error) {
                    toast.error(`Analysis error: ${error.message}`);
                } finally {
                    setLoading(false);
                }
            };

            // Generate report
            const generateReport = async () => {
                if (!analysisResults) {
                    toast.error('Please run analysis first!');
                    return;
                }

                try {
                    const filename = reportGenerator.generateReport(
                        dataInfo,
                        analysisResults.missingInfo,
                        analysisResults.outliersInfo,
                        analysisResults.estimates,
                        analysisResults.summaryStats,
                        analysisResults.correlationMatrix,
                        config
                    );
                    
                    toast.success(`Report generated: ${filename}`);
                } catch (error) {
                    toast.error(`Report generation error: ${error.message}`);
                }
            };

            // Update configuration
            const updateConfig = (key, value) => {
                setConfig(prev => ({ ...prev, [key]: value }));
            };

            // Navigation functions
            const goToStep = (step) => {
                if (step <= currentStep) {
                    setCurrentStep(step);
                }
            };

            const nextStep = () => {
                if (currentStep < 4) {
                    setCurrentStep(currentStep + 1);
                }
            };

            const prevStep = () => {
                if (currentStep > 1) {
                    setCurrentStep(currentStep - 1);
                }
            };

            // Render current step content
            const renderStepContent = () => {
                switch (currentStep) {
                    case 1:
                        return (
                            <FileUpload 
                                onFileUpload={handleFileUpload}
                                dataInfo={dataInfo}
                                loading={loading}
                            />
                        );
                    case 2:
                        return (
                            <DataCleaning 
                                config={config}
                                updateConfig={updateConfig}
                                dataInfo={dataInfo}
                                onNext={nextStep}
                                onPrev={prevStep}
                            />
                        );
                    case 3:
                        return (
                            <WeightApplication 
                                config={config}
                                updateConfig={updateConfig}
                                dataInfo={dataInfo}
                                onNext={nextStep}
                                onPrev={prevStep}
                            />
                        );
                    case 4:
                        return (
                            <AnalysisResults 
                                analysisResults={analysisResults}
                                dataInfo={dataInfo}
                                config={config}
                                onRunAnalysis={runAnalysis}
                                onGenerateReport={generateReport}
                                loading={loading}
                                onPrev={prevStep}
                            />
                        );
                    default:
                        return null;
                }
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50">
                    <Toaster 
                        position="top-right"
                        toastOptions={{
                            duration: 4000,
                            style: {
                                background: '#fff',
                                color: '#374151',
                                borderRadius: '12px',
                                boxShadow: '0 10px 25px -5px rgba(0, 0, 0, 0.1)',
                                border: '1px solid #e5e7eb',
                            },
                        }}
                    />
                    
                    <Header 
                        sidebarOpen={sidebarOpen}
                        setSidebarOpen={setSidebarOpen}
                        currentView={currentView}
                        setCurrentView={setCurrentView}
                        analytics={analytics}
                    />

                    <div className="flex">
                        <Sidebar 
                            sidebarOpen={sidebarOpen}
                            setSidebarOpen={setSidebarOpen}
                            currentStep={currentStep}
                            goToStep={goToStep}
                            currentView={currentView}
                            setCurrentView={setCurrentView}
                            analytics={analytics}
                        />

                        <main className="flex-1 p-6 lg:p-8">
                            {currentView === 'workflow' ? (
                                <div className="max-w-7xl mx-auto">
                                    <ProgressTracker 
                                        currentStep={currentStep}
                                        goToStep={goToStep}
                                        dataInfo={dataInfo}
                                        analysisResults={analysisResults}
                                    />

                                    <div className="mt-8">
                                        {renderStepContent()}
                                    </div>
                                </div>
                            ) : currentView === 'dashboard' ? (
                                <Dashboard 
                                    analytics={analytics}
                                    dataInfo={dataInfo}
                                    analysisResults={analysisResults}
                                    config={config}
                                />
                            ) : currentView === 'results' ? (
                                <AnalysisResults 
                                    analysisResults={analysisResults}
                                    dataInfo={dataInfo}
                                    config={config}
                                    onRunAnalysis={runAnalysis}
                                    onGenerateReport={generateReport}
                                    loading={loading}
                                    onPrev={prevStep}
                                    detailed={true}
                                />
                            ) : null}
                        </main>
                    </div>

                    {loading && <LoadingSpinner />}
                </div>
            );
        }

        // Header Component
        function Header({ sidebarOpen, setSidebarOpen, currentView, setCurrentView, analytics }) {
            const formatNumber = (num) => {
                if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
                if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
                return num.toString();
            };

            return (
                <header className="bg-white/80 backdrop-blur-md border-b border-gray-200/50 sticky top-0 z-50">
                    <div className="px-6 lg:px-8">
                        <div className="flex items-center justify-between h-16">
                            <div className="flex items-center space-x-4">
                                <button
                                    onClick={() => setSidebarOpen(!sidebarOpen)}
                                    className="p-2 rounded-xl hover:bg-gray-100 transition-colors duration-200 lg:hidden"
                                >
                                    {sidebarOpen ? '✕' : '☰'}
                                </button>

                                <div className="flex items-center space-x-3">
                                    <div className="relative">
                                        <div className="w-10 h-10 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center shadow-glow">
                                            🧠
                                        </div>
                                        <div className="absolute -top-1 -right-1 w-4 h-4 bg-green-500 rounded-full border-2 border-white animate-pulse"></div>
                                    </div>
                                    
                                    <div className="hidden sm:block">
                                        <h1 className="text-xl font-bold gradient-text">
                                            AI-Enhanced Survey Analysis
                                        </h1>
                                        <p className="text-xs text-gray-500 -mt-1">
                                            MoSPI Hackathon Solution
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <div className="hidden lg:flex items-center space-x-1">
                                <button
                                    onClick={() => setCurrentView('workflow')}
                                    className={`px-4 py-2 rounded-xl font-medium transition-all duration-200 ${
                                        currentView === 'workflow'
                                            ? 'bg-blue-100 text-blue-700 shadow-lg'
                                            : 'text-gray-600 hover:text-blue-600 hover:bg-gray-50'
                                    }`}
                                >
                                    📊 Workflow
                                </button>
                                
                                <button
                                    onClick={() => setCurrentView('dashboard')}
                                    className={`px-4 py-2 rounded-xl font-medium transition-all duration-200 ${
                                        currentView === 'dashboard'
                                            ? 'bg-blue-100 text-blue-700 shadow-lg'
                                            : 'text-gray-600 hover:text-blue-600 hover:bg-gray-50'
                                    }`}
                                >
                                    📈 Dashboard
                                </button>
                                
                                <button
                                    onClick={() => setCurrentView('results')}
                                    className={`px-4 py-2 rounded-xl font-medium transition-all duration-200 ${
                                        currentView === 'results'
                                            ? 'bg-blue-100 text-blue-700 shadow-lg'
                                            : 'text-gray-600 hover:text-blue-600 hover:bg-gray-50'
                                    }`}
                                >
                                    📄 Results
                                </button>
                            </div>

                            <div className="flex items-center space-x-3">
                                <div className="hidden md:flex items-center space-x-4">
                                    <div className="flex items-center space-x-2 px-3 py-1.5 bg-green-50 rounded-lg border border-green-200">
                                        <span className="text-sm font-medium text-green-700">
                                            {formatNumber(analytics.totalFilesProcessed)} files
                                        </span>
                                    </div>
                                    
                                    <div className="flex items-center space-x-2 px-3 py-1.5 bg-blue-50 rounded-lg border border-blue-200">
                                        <span className="text-sm font-medium text-blue-700">
                                            {formatNumber(analytics.totalRecordsAnalyzed)} records
                                        </span>
                                    </div>
                                </div>

                                <button className="relative p-2 rounded-xl hover:bg-gray-100 transition-colors duration-200">
                                    🔔
                                    <div className="absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full"></div>
                                </button>

                                <button className="flex items-center space-x-2 p-2 rounded-xl hover:bg-gray-100 transition-colors duration-200">
                                    <div className="w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-500 rounded-lg flex items-center justify-center">
                                        👤
                                    </div>
                                    <span className="hidden sm:block text-sm font-medium text-gray-700">
                                        Analyst
                                    </span>
                                </button>
                            </div>
                        </div>
                    </div>
                </header>
            );
        }

        // Sidebar Component
        function Sidebar({ sidebarOpen, setSidebarOpen, currentStep, goToStep, currentView, setCurrentView, analytics }) {
            const steps = [
                {
                    id: 1,
                    title: 'Data Upload',
                    description: 'Upload your survey data',
                    status: currentStep >= 1 ? 'completed' : 'pending'
                },
                {
                    id: 2,
                    title: 'Data Cleaning',
                    description: 'Configure cleaning methods',
                    status: currentStep >= 2 ? 'completed' : 'pending'
                },
                {
                    id: 3,
                    title: 'Weight Application',
                    description: 'Apply survey weights',
                    status: currentStep >= 3 ? 'completed' : 'pending'
                },
                {
                    id: 4,
                    title: 'Analysis & Results',
                    description: 'Generate estimates & reports',
                    status: currentStep >= 4 ? 'completed' : 'pending'
                }
            ];

            const formatNumber = (num) => {
                if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
                if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
                return num.toString();
            };

            if (!sidebarOpen) return null;

            return (
                <div className="fixed inset-y-0 left-0 z-40 w-80 bg-white border-r border-gray-200 lg:static lg:translate-x-0">
                    <div className="flex flex-col h-full">
                        <div className="p-6 border-b border-gray-200">
                            <div className="flex items-center space-x-3">
                                <div className="w-10 h-10 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center">
                                    🧠
                                </div>
                                <div>
                                    <h2 className="text-lg font-bold text-gray-900">Workflow</h2>
                                    <p className="text-sm text-gray-500">Step {currentStep} of 4</p>
                                </div>
                            </div>
                        </div>

                        <div className="flex-1 overflow-y-auto p-6 space-y-8">
                            <div>
                                <h3 className="text-sm font-semibold text-gray-900 mb-4 flex items-center">
                                    🎯 Progress
                                </h3>
                                <div className="space-y-3">
                                    {steps.map((step, index) => (
                                        <button
                                            key={step.id}
                                            onClick={() => goToStep(step.id)}
                                            className={`w-full flex items-center space-x-3 p-3 rounded-xl transition-all duration-200 ${
                                                step.status === 'completed'
                                                    ? 'bg-green-50 border border-green-200 hover:bg-green-100'
                                                    : currentStep === step.id
                                                    ? 'bg-blue-50 border border-blue-200 shadow-lg'
                                                    : 'bg-gray-50 border border-gray-200 hover:bg-gray-100'
                                            }`}
                                        >
                                            <div className={`w-8 h-8 rounded-lg flex items-center justify-center ${
                                                step.status === 'completed'
                                                    ? 'bg-green-500'
                                                    : currentStep === step.id
                                                    ? 'bg-blue-500'
                                                    : 'bg-gray-300'
                                            }`}>
                                                {step.status === 'completed' ? '✅' : '📋'}
                                            </div>
                                            <div className="flex-1 text-left">
                                                <p className={`text-sm font-medium ${
                                                    step.status === 'completed'
                                                        ? 'text-green-700'
                                                        : currentStep === step.id
                                                        ? 'text-blue-700'
                                                        : 'text-gray-700'
                                                }`}>
                                                    {step.title}
                                                </p>
                                                <p className="text-xs text-gray-500">{step.description}</p>
                                            </div>
                                        </button>
                                    ))}
                                </div>
                            </div>

                            <div>
                                <h3 className="text-sm font-semibold text-gray-900 mb-4 flex items-center">
                                    📊 Analytics
                                </h3>
                                <div className="space-y-3">
                                    <div className="p-3 bg-green-50 rounded-xl border border-green-200">
                                        <div className="flex items-center justify-between">
                                            <span className="text-sm font-medium text-green-700">Files Processed</span>
                                            <span className="text-lg font-bold text-green-800">
                                                {formatNumber(analytics.totalFilesProcessed)}
                                            </span>
                                        </div>
                                    </div>
                                    
                                    <div className="p-3 bg-blue-50 rounded-xl border border-blue-200">
                                        <div className="flex items-center justify-between">
                                            <span className="text-sm font-medium text-blue-700">Records Analyzed</span>
                                            <span className="text-lg font-bold text-blue-800">
                                                {formatNumber(analytics.totalRecordsAnalyzed)}
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div className="p-6 border-t border-gray-200">
                            <div className="text-center">
                                <p className="text-xs text-gray-500 mb-2">MoSPI Hackathon 2024</p>
                                <div className="flex items-center justify-center space-x-1">
                                    <div className="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                                    <span className="text-xs text-green-600 font-medium">AI-Enhanced</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // FileUpload Component
        function FileUpload({ onFileUpload, dataInfo, loading }) {
            const [dragActive, setDragActive] = React.useState(false);

            const handleDrag = (e) => {
                e.preventDefault();
                e.stopPropagation();
                if (e.type === "dragenter" || e.type === "dragover") {
                    setDragActive(true);
                } else if (e.type === "dragleave") {
                    setDragActive(false);
                }
            };

            const handleDrop = (e) => {
                e.preventDefault();
                e.stopPropagation();
                setDragActive(false);
                
                if (e.dataTransfer.files && e.dataTransfer.files[0]) {
                    onFileUpload(e.dataTransfer.files[0]);
                }
            };

            const handleFileInput = (e) => {
                if (e.target.files && e.target.files[0]) {
                    onFileUpload(e.target.files[0]);
                }
            };

            return (
                <div className="space-y-8">
                    <div className="text-center">
                        <div className="w-20 h-20 bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl flex items-center justify-center mx-auto mb-6 shadow-glow">
                            📤
                        </div>
                        
                        <h2 className="text-3xl font-bold text-gray-900 mb-4">
                            Upload Your Survey Data
                        </h2>
                        <p className="text-lg text-gray-600 max-w-2xl mx-auto">
                            Start your AI-enhanced analysis by uploading your CSV or Excel survey data. 
                            Our intelligent system will automatically detect and validate your data structure.
                        </p>
                    </div>

                    <div className="max-w-4xl mx-auto">
                        <div
                            onDragEnter={handleDrag}
                            onDragLeave={handleDrag}
                            onDragOver={handleDrag}
                            onDrop={handleDrop}
                            className={`relative border-2 border-dashed rounded-2xl p-12 text-center transition-all duration-300 cursor-pointer ${
                                dragActive
                                    ? 'border-blue-500 bg-blue-50 shadow-glow'
                                    : 'border-gray-300 hover:border-blue-400 hover:bg-gray-50'
                            }`}
                            onClick={() => document.getElementById('fileInput').click()}
                        >
                            <input 
                                id="fileInput"
                                type="file" 
                                accept=".csv,.xlsx,.xls"
                                onChange={handleFileInput}
                                className="hidden"
                            />
                            
                            <div className="space-y-4">
                                <div className="flex justify-center">
                                    <div className={`w-16 h-16 rounded-xl flex items-center justify-center ${
                                        dragActive ? 'bg-blue-100' : 'bg-gray-100'
                                    }`}>
                                        {dragActive ? '📤' : '📄'}
                                    </div>
                                </div>
                                
                                <div>
                                    <h3 className="text-xl font-semibold text-gray-900 mb-2">
                                        {dragActive ? 'Drop your file here' : 'Drag & drop your file here'}
                                    </h3>
                                    <p className="text-gray-600 mb-4">
                                        or click to browse your files
                                    </p>
                                    <p className="text-sm text-gray-500">
                                        Supports CSV, Excel (.xlsx, .xls) files up to 50MB
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    {dataInfo && (
                        <div className="max-w-4xl mx-auto">
                            <div className="card p-8">
                                <div className="flex items-center space-x-3 mb-6">
                                    <div className="w-10 h-10 bg-green-100 rounded-xl flex items-center justify-center">
                                        ✅
                                    </div>
                                    <div>
                                        <h3 className="text-xl font-bold text-gray-900">Data Successfully Loaded</h3>
                                        <p className="text-gray-600">Your survey data is ready for analysis</p>
                                    </div>
                                </div>

                                <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                                    <div className="p-4 bg-blue-50 rounded-xl">
                                        <div className="flex items-center space-x-2 mb-2">
                                            <span className="font-semibold text-blue-700">Dataset Size</span>
                                        </div>
                                        <p className="text-2xl font-bold text-blue-800">
                                            {dataInfo.shape[0].toLocaleString()} × {dataInfo.shape[1]}
                                        </p>
                                        <p className="text-sm text-blue-600">rows × columns</p>
                                    </div>

                                    <div className="p-4 bg-green-50 rounded-xl">
                                        <div className="flex items-center space-x-2 mb-2">
                                            <span className="font-semibold text-green-700">Total Columns</span>
                                        </div>
                                        <p className="text-2xl font-bold text-green-800">
                                            {dataInfo.columns.length}
                                        </p>
                                        <p className="text-sm text-green-600">variables</p>
                                    </div>

                                    <div className="p-4 bg-yellow-50 rounded-xl">
                                        <div className="flex items-center space-x-2 mb-2">
                                            <span className="font-semibold text-yellow-700">Numeric Columns</span>
                                        </div>
                                        <p className="text-2xl font-bold text-yellow-800">
                                            {dataInfo.numericColumns.length}
                                        </p>
                                        <p className="text-sm text-yellow-600">for analysis</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {loading && (
                        <div className="text-center py-12">
                            <div className="inline-flex items-center space-x-3">
                                <div className="w-6 h-6 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"></div>
                                <span className="text-lg font-medium text-gray-700">Processing your data...</span>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // DataCleaning Component
        function DataCleaning({ config, updateConfig, dataInfo, onNext, onPrev }) {
            const imputationMethods = [
                { value: 'mean', label: 'Mean Imputation', description: 'Replace missing values with column mean' },
                { value: 'median', label: 'Median Imputation', description: 'Replace missing values with column median' },
                { value: 'knn', label: 'K-Nearest Neighbors', description: 'AI-powered imputation using similar records' }
            ];

            const outlierMethods = [
                { value: 'iqr', label: 'Interquartile Range (IQR)', description: 'Detect outliers using Q1-Q3 range' },
                { value: 'zscore', label: 'Z-Score Method', description: 'Detect outliers using standard deviations' }
            ];

            return (
                <div className="space-y-8">
                    <div className="text-center">
                        <div className="w-20 h-20 bg-gradient-to-br from-yellow-500 to-yellow-600 rounded-2xl flex items-center justify-center mx-auto mb-6 shadow-glow">
                            ⚙️
                        </div>
                        
                        <h2 className="text-3xl font-bold text-gray-900 mb-4">
                            AI-Enhanced Data Cleaning
                        </h2>
                        <p className="text-lg text-gray-600 max-w-2xl mx-auto">
                            Configure intelligent data cleaning methods to handle missing values and outliers.
                        </p>
                    </div>

                    <div className="max-w-6xl mx-auto space-y-8">
                        <div className="card p-8">
                            <div className="flex items-center space-x-3 mb-6">
                                <div className="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center">
                                    ✨
                                </div>
                                <div>
                                    <h3 className="text-xl font-bold text-gray-900">Missing Value Imputation</h3>
                                    <p className="text-gray-600">Choose how to handle missing data intelligently</p>
                                </div>
                            </div>

                            <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                                <div>
                                    <label className="block text-sm font-semibold text-gray-700 mb-3">
                                        Imputation Method
                                    </label>
                                    <select
                                        value={config.imputationMethod}
                                        onChange={(e) => updateConfig('imputationMethod', e.target.value)}
                                        className="input-field"
                                    >
                                        <option value="">Select method...</option>
                                        {imputationMethods.map(method => (
                                            <option key={method.value} value={method.value}>
                                                {method.label}
                                            </option>
                                        ))}
                                    </select>
                                </div>

                                <div>
                                    <label className="block text-sm font-semibold text-gray-700 mb-3">
                                        Columns to Impute
                                    </label>
                                    <select
                                        multiple
                                        value={config.imputationColumns}
                                        onChange={(e) => updateConfig('imputationColumns', 
                                            Array.from(e.target.selectedOptions, option => option.value)
                                        )}
                                        className="input-field"
                                    >
                                        {dataInfo?.columns.map(col => (
                                            <option key={col} value={col}>{col}</option>
                                        ))}
                                    </select>
                                    <p className="text-xs text-gray-500 mt-2">
                                        Leave empty to apply to all numeric columns
                                    </p>
                                </div>
                            </div>
                        </div>

                        <div className="card p-8">
                            <div className="flex items-center space-x-3 mb-6">
                                <div className="w-12 h-12 bg-yellow-100 rounded-xl flex items-center justify-center">
                                    🛡️
                                </div>
                                <div>
                                    <h3 className="text-xl font-bold text-gray-900">Outlier Detection & Handling</h3>
                                    <p className="text-gray-600">Identify and handle statistical outliers</p>
                                </div>
                            </div>

                            <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                                <div>
                                    <label className="block text-sm font-semibold text-gray-700 mb-3">
                                        Detection Method
                                    </label>
                                    <select
                                        value={config.outlierMethod}
                                        onChange={(e) => updateConfig('outlierMethod', e.target.value)}
                                        className="input-field"
                                    >
                                        <option value="">Select method...</option>
                                        {outlierMethods.map(method => (
                                            <option key={method.value} value={method.value}>
                                                {method.label}
                                            </option>
                                        ))}
                                    </select>
                                </div>

                                <div>
                                    <label className="block text-sm font-semibold text-gray-700 mb-3">
                                        Handling Strategy
                                    </label>
                                    <select
                                        value={config.outlierHandling}
                                        onChange={(e) => updateConfig('outlierHandling', e.target.value)}
                                        className="input-field"
                                    >
                                        <option value="winsorize">Winsorize (Cap at percentiles)</option>
                                        <option value="remove">Remove Outliers</option>
                                    </select>
                                </div>

                                <div>
                                    <label className="block text-sm font-semibold text-gray-700 mb-3">
                                        Columns to Check
                                    </label>
                                    <select
                                        multiple
                                        value={config.outlierColumns}
                                        onChange={(e) => updateConfig('outlierColumns', 
                                            Array.from(e.target.selectedOptions, option => option.value)
                                        )}
                                        className="input-field"
                                    >
                                        {dataInfo?.numericColumns.map(col => (
                                            <option key={col} value={col}>{col}</option>
                                        ))}
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className="flex justify-between items-center max-w-4xl mx-auto pt-8">
                        <button onClick={onPrev} className="btn-secondary">
                            ← Previous Step
                        </button>
                        <button onClick={onNext} className="btn-primary">
                            Next: Weight Application →
                        </button>
                    </div>
                </div>
            );
        }

        // WeightApplication Component
        function WeightApplication({ config, updateConfig, dataInfo, onNext, onPrev }) {
            return (
                <div className="space-y-8">
                    <div className="text-center">
                        <div className="w-20 h-20 bg-gradient-to-br from-green-500 to-green-600 rounded-2xl flex items-center justify-center mx-auto mb-6 shadow-glow-success">
                            📊
                        </div>
                        
                        <h2 className="text-3xl font-bold text-gray-900 mb-4">
                            Survey Weight Application
                        </h2>
                        <p className="text-lg text-gray-600 max-w-2xl mx-auto">
                            Configure survey weights and estimation variables to produce accurate population estimates.
                        </p>
                    </div>

                    <div className="max-w-6xl mx-auto space-y-8">
                        <div className="card p-8">
                            <div className="flex items-center space-x-3 mb-6">
                                <div className="w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center">
                                    🧮
                                </div>
                                <div>
                                    <h3 className="text-xl font-bold text-gray-900">Weight Configuration</h3>
                                    <p className="text-gray-600">Select and configure survey weights for accurate estimation</p>
                                </div>
                            </div>

                            <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                                <div>
                                    <label className="block text-sm font-semibold text-gray-700 mb-3">
                                        Weight Column
                                    </label>
                                    <select
                                        value={config.weightColumn}
                                        onChange={(e) => updateConfig('weightColumn', e.target.value)}
                                        className="input-field"
                                    >
                                        <option value="">No weights (equal weights)</option>
                                        {dataInfo?.columns.map(col => (
                                            <option key={col} value={col}>{col}</option>
                                        ))}
                                    </select>
                                    <p className="text-xs text-gray-500 mt-2">
                                        Leave empty to use equal weights (1.0) for all records
                                    </p>
                                </div>

                                <div>
                                    <label className="block text-sm font-semibold text-gray-700 mb-3">
                                        Variables to Estimate
                                    </label>
                                    <select
                                        multiple
                                        value={config.estimateColumns}
                                        onChange={(e) => updateConfig('estimateColumns', 
                                            Array.from(e.target.selectedOptions, option => option.value)
                                        )}
                                        className="input-field"
                                    >
                                        {dataInfo?.numericColumns.map(col => (
                                            <option key={col} value={col}>{col}</option>
                                        ))}
                                    </select>
                                    <p className="text-xs text-gray-500 mt-2">
                                        Leave empty to estimate all numeric variables
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className="flex justify-between items-center max-w-4xl mx-auto pt-8">
                        <button onClick={onPrev} className="btn-secondary">
                            ← Previous Step
                        </button>
                        <button onClick={onNext} className="btn-primary">
                            Next: Analysis & Results →
                        </button>
                    </div>
                </div>
            );
        }

        // AnalysisResults Component
        function AnalysisResults({ analysisResults, dataInfo, config, onRunAnalysis, onGenerateReport, loading, onPrev, detailed = false }) {
            const formatNumber = (num) => {
                if (typeof num !== 'number') return 'N/A';
                return num.toLocaleString('en-US', { 
                    minimumFractionDigits: 2, 
                    maximumFractionDigits: 4 
                });
            };

            if (!analysisResults && !detailed) {
                return (
                    <div className="space-y-8">
                        <div className="text-center">
                            <div className="w-20 h-20 bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl flex items-center justify-center mx-auto mb-6 shadow-glow">
                                📊
                            </div>
                            
                            <h2 className="text-3xl font-bold text-gray-900 mb-4">
                                Analysis & Results
                            </h2>
                            <p className="text-lg text-gray-600 max-w-2xl mx-auto">
                                Run AI-enhanced analysis to generate statistical estimates, 
                                detect patterns, and produce professional reports.
                            </p>
                        </div>

                        <div className="max-w-4xl mx-auto">
                            <div className="card p-8 text-center">
                                <div className="w-16 h-16 bg-blue-100 rounded-xl flex items-center justify-center mx-auto mb-4">
                                    🧠
                                </div>
                                <h3 className="text-xl font-bold text-gray-900 mb-2">Ready for Analysis</h3>
                                <p className="text-gray-600 mb-6">
                                    Your data is prepared and configured. Click the button below to start the AI-enhanced analysis.
                                </p>
                                <button
                                    onClick={onRunAnalysis}
                                    disabled={loading}
                                    className="btn-primary"
                                >
                                    {loading ? (
                                        <div className="flex items-center space-x-2">
                                            <div className="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                                            <span>Running Analysis...</span>
                                        </div>
                                    ) : (
                                        <div className="flex items-center space-x-2">
                                            ✨
                                            <span>Run AI-Enhanced Analysis</span>
                                        </div>
                                    )}
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="space-y-8">
                    <div className="text-center">
                        <div className="w-20 h-20 bg-gradient-to-br from-green-500 to-green-600 rounded-2xl flex items-center justify-center mx-auto mb-6 shadow-glow-success">
                            ✅
                        </div>
                        
                        <h2 className="text-3xl font-bold text-gray-900 mb-4">
                            Analysis Results
                        </h2>
                        <p className="text-lg text-gray-600 max-w-2xl mx-auto">
                            AI-enhanced analysis completed successfully. Review your statistical estimates and generate professional reports.
                        </p>
                    </div>

                    {analysisResults && (
                        <div className="max-w-6xl mx-auto">
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                                <div className="card p-6 text-center">
                                    <div className="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center mx-auto mb-4">
                                        👥
                                    </div>
                                    <p className="text-2xl font-bold text-blue-800">
                                        {analysisResults.cleanedShape ? analysisResults.cleanedShape[0].toLocaleString() : 'N/A'}
                                    </p>
                                    <p className="text-sm text-gray-600">Records Analyzed</p>
                                </div>

                                <div className="card p-6 text-center">
                                    <div className="w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center mx-auto mb-4">
                                        🎯
                                    </div>
                                    <p className="text-2xl font-bold text-green-800">
                                        {Object.keys(analysisResults.estimates || {}).length}
                                    </p>
                                    <p className="text-sm text-gray-600">Variables Estimated</p>
                                </div>

                                <div className="card p-6 text-center">
                                    <div className="w-12 h-12 bg-yellow-100 rounded-xl flex items-center justify-center mx-auto mb-4">
                                        ⚠️
                                    </div>
                                    <p className="text-2xl font-bold text-yellow-800">
                                        {analysisResults.missingInfo?.totalMissing || 0}
                                    </p>
                                    <p className="text-sm text-gray-600">Missing Values</p>
                                </div>

                                <div className="card p-6 text-center">
                                    <div className="w-12 h-12 bg-red-100 rounded-xl flex items-center justify-center mx-auto mb-4">
                                        ⏱️
                                    </div>
                                    <p className="text-2xl font-bold text-red-800">
                                        {analysisResults.processingTime ? `${Math.round(analysisResults.processingTime)}ms` : 'N/A'}
                                    </p>
                                    <p className="text-sm text-gray-600">Processing Time</p>
                                </div>
                            </div>

                            {analysisResults.estimates && (
                                <div className="card p-8 mt-8">
                                    <div className="flex items-center space-x-3 mb-6">
                                        <div className="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center">
                                            📈
                                        </div>
                                        <div>
                                            <h3 className="text-xl font-bold text-gray-900">Statistical Estimates</h3>
                                            <p className="text-gray-600">Population estimates with margins of error</p>
                                        </div>
                                    </div>

                                    <div className="overflow-x-auto">
                                        <table className="w-full text-sm">
                                            <thead>
                                                <tr className="bg-gray-50">
                                                    <th className="px-4 py-3 text-left font-semibold text-gray-700">Variable</th>
                                                    <th className="px-4 py-3 text-center font-semibold text-gray-700">Unweighted Mean</th>
                                                    <th className="px-4 py-3 text-center font-semibold text-gray-700">Weighted Mean</th>
                                                    <th className="px-4 py-3 text-center font-semibold text-gray-700">Margin of Error</th>
                                                    <th className="px-4 py-3 text-center font-semibold text-gray-700">Standard Error</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {Object.entries(analysisResults.estimates).map(([variable, est]) => (
                                                    <tr key={variable} className="border-b border-gray-100 hover:bg-gray-50">
                                                        <td className="px-4 py-3 font-medium text-gray-900">{variable}</td>
                                                        <td className="px-4 py-3 text-center text-gray-700">
                                                            {formatNumber(est.unweighted.mean)}
                                                        </td>
                                                        <td className="px-4 py-3 text-center text-blue-700 font-semibold">
                                                            {formatNumber(est.weighted.mean)}
                                                        </td>
                                                        <td className="px-4 py-3 text-center text-yellow-700">
                                                            ±{formatNumber(est.weighted.moe)}
                                                        </td>
                                                        <td className="px-4 py-3 text-center text-gray-600">
                                                            {formatNumber(est.weighted.se)}
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            )}
                        </div>
                    )}

                    <div className="max-w-4xl mx-auto">
                        <div className="card p-8 text-center">
                            <div className="w-16 h-16 bg-green-100 rounded-xl flex items-center justify-center mx-auto mb-4">
                                📄
                            </div>
                            <h3 className="text-xl font-bold text-gray-900 mb-2">Generate Professional Report</h3>
                            <p className="text-gray-600 mb-6">
                                Create a comprehensive PDF report with all analysis results, methodology, and visualizations.
                            </p>
                            <button
                                onClick={onGenerateReport}
                                className="btn-success"
                            >
                                <div className="flex items-center space-x-2">
                                    📥
                                    <span>Generate PDF Report</span>
                                </div>
                            </button>
                        </div>
                    </div>

                    <div className="flex justify-between items-center max-w-4xl mx-auto pt-8">
                        <button onClick={onPrev} className="btn-secondary">
                            ← Previous Step
                        </button>
                        <div className="flex items-center space-x-2">
                            <div className="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                            <span className="text-sm text-green-600 font-medium">Analysis Complete</span>
                        </div>
                    </div>
                </div>
            );
        }

        // Dashboard Component
        function Dashboard({ analytics, dataInfo, analysisResults, config }) {
            const formatNumber = (num) => {
                if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
                if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
                return num.toString();
            };

            const metrics = [
                {
                    title: 'Files Processed',
                    value: formatNumber(analytics.totalFilesProcessed),
                    change: '+12%',
                    icon: '📁',
                    color: 'blue'
                },
                {
                    title: 'Records Analyzed',
                    value: formatNumber(analytics.totalRecordsAnalyzed),
                    change: '+8%',
                    icon: '👥',
                    color: 'green'
                },
                {
                    title: 'Avg. Processing Time',
                    value: analytics.averageProcessingTime > 0 ? `${Math.round(analytics.averageProcessingTime)}ms` : 'Ready',
                    change: '-15%',
                    icon: '⏱️',
                    color: 'yellow'
                },
                {
                    title: 'Success Rate',
                    value: `${analytics.successRate}%`,
                    change: '+2%',
                    icon: '✅',
                    color: 'green'
                }
            ];

            return (
                <div className="space-y-8">
                    <div className="text-center">
                        <div className="w-20 h-20 bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl flex items-center justify-center mx-auto mb-6 shadow-glow">
                            📊
                        </div>
                        
                        <h2 className="text-3xl font-bold text-gray-900 mb-4">
                            Analytics Dashboard
                        </h2>
                        <p className="text-lg text-gray-600 max-w-2xl mx-auto">
                            Monitor your AI-enhanced survey analysis performance and track key metrics.
                        </p>
                    </div>

                    <div className="max-w-7xl mx-auto">
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                            {metrics.map((metric, index) => (
                                <div key={metric.title} className="card p-6">
                                    <div className="flex items-center justify-between mb-4">
                                        <div className={`w-12 h-12 bg-${metric.color}-100 rounded-xl flex items-center justify-center`}>
                                            {metric.icon}
                                        </div>
                                        <span className={`text-sm font-medium text-${metric.color}-600`}>
                                            {metric.change}
                                        </span>
                                    </div>
                                    <p className="text-2xl font-bold text-gray-900 mb-1">{metric.value}</p>
                                    <p className="text-sm text-gray-600">{metric.title}</p>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        }

        // ProgressTracker Component
        function ProgressTracker({ currentStep, goToStep, dataInfo, analysisResults }) {
            const steps = [
                {
                    id: 1,
                    title: 'Data Upload',
                    description: 'Upload survey data',
                    status: dataInfo ? 'completed' : currentStep >= 1 ? 'active' : 'pending'
                },
                {
                    id: 2,
                    title: 'Data Cleaning',
                    description: 'Configure cleaning methods',
                    status: currentStep >= 2 ? 'completed' : currentStep === 2 ? 'active' : 'pending'
                },
                {
                    id: 3,
                    title: 'Weight Application',
                    description: 'Apply survey weights',
                    status: currentStep >= 3 ? 'completed' : currentStep === 3 ? 'active' : 'pending'
                },
                {
                    id: 4,
                    title: 'Analysis & Results',
                    description: 'Generate estimates & reports',
                    status: analysisResults ? 'completed' : currentStep === 4 ? 'active' : 'pending'
                }
            ];

            return (
                <div className="max-w-4xl mx-auto">
                    <div className="card p-6">
                        <div className="flex items-center justify-between mb-6">
                            <h3 className="text-lg font-bold text-gray-900">Workflow Progress</h3>
                            <span className="text-sm text-gray-500">Step {currentStep} of 4</span>
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                            {steps.map((step, index) => (
                                <button
                                    key={step.id}
                                    onClick={() => goToStep(step.id)}
                                    className={`relative p-4 rounded-xl border transition-all duration-200 ${
                                        step.status === 'completed'
                                            ? 'text-green-600 bg-green-50 border-green-200 hover:bg-green-100'
                                            : currentStep === step.id
                                            ? 'text-blue-600 bg-blue-50 border-blue-200 shadow-lg'
                                            : 'text-gray-500 bg-gray-50 border-gray-200 hover:bg-gray-100'
                                    } ${step.status !== 'pending' ? 'hover:shadow-lg cursor-pointer' : 'cursor-not-allowed'}`}
                                >
                                    <div className="flex items-center space-x-3">
                                        <div className={`w-8 h-8 rounded-lg flex items-center justify-center ${
                                            step.status === 'completed' ? 'bg-green-500' :
                                            step.status === 'active' ? 'bg-blue-500' : 'bg-gray-300'
                                        }`}>
                                            {step.status === 'completed' ? '✅' : '📋'}
                                        </div>
                                        <div className="flex-1 text-left">
                                            <p className={`text-sm font-medium ${
                                                step.status === 'completed' ? 'text-green-700' :
                                                step.status === 'active' ? 'text-blue-700' : 'text-gray-500'
                                            }`}>
                                                {step.title}
                                            </p>
                                            <p className="text-xs text-gray-500">{step.description}</p>
                                        </div>
                                    </div>
                                </button>
                            ))}
                        </div>

                        <div className="mt-6">
                            <div className="flex justify-between text-xs text-gray-500 mb-2">
                                <span>Progress</span>
                                <span>{Math.round((currentStep / 4) * 100)}%</span>
                            </div>
                            <div className="w-full bg-gray-200 rounded-full h-2">
                                <div 
                                    className="bg-gradient-to-r from-blue-500 to-blue-600 h-2 rounded-full transition-all duration-500"
                                    style={{ width: `${(currentStep / 4) * 100}%` }}
                                />
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // LoadingSpinner Component
        function LoadingSpinner() {
            return (
                <div className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50">
                    <div className="bg-white rounded-2xl p-8 shadow-xl max-w-sm mx-4">
                        <div className="text-center">
                            <div className="w-16 h-16 bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-glow animate-spin">
                                🧠
                            </div>
                            
                            <h3 className="text-lg font-bold text-gray-900 mb-2">
                                AI Processing...
                            </h3>
                            <p className="text-gray-600 mb-4">
                                Our intelligent system is analyzing your data
                            </p>
                            
                            <div className="flex items-center justify-center space-x-1">
                                <div className="w-2 h-2 bg-blue-500 rounded-full animate-bounce"></div>
                                <div className="w-2 h-2 bg-blue-500 rounded-full animate-bounce" style={{animationDelay: '0.2s'}}></div>
                                <div className="w-2 h-2 bg-blue-500 rounded-full animate-bounce" style={{animationDelay: '0.4s'}}></div>
                            </div>
                            
                            <div className="flex items-center justify-center space-x-1 mt-4">
                                ✨
                                <span className="text-xs text-blue-600 font-medium">AI-Enhanced Analysis</span>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // Render the app
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html> 